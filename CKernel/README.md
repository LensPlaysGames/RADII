# An Example `C` Kernel
This is an example that could be used as a starting point for writing
  a kernel in the `C` programming language based on the RADII bootloader.

---

### Table of Contents

- [Building](#building)
- [Running](#running)

---

### Building <a name="building"></a>

- [Dependencies](#deps)
- [Build System](#build-system)
- [Boot Media Generation](#boot-media)

#### Dependencies <a name="deps"></a>

This tutorial uses CMake. Alternatively, see [instructions for Meson](README.meson.md).

- A C compiler targeting `x86_64-linux-gnu`.
  - On Debian: `sudo apt install build-essential`
  - For Windows users, it is easiest to just use the
    [Windows Subsystem for Linux (WSL)](https://docs.microsoft.com/en-us/windows/wsl/about),
    rather than trying to build a native, cross-compiling toolchain using something like
    [Cygwin](https://www.cygwin.com/).
- CMake
  - [Home Page](https://cmake.org/)
  - On Debian: `sudo apt install cmake`
  - On Windows: [See downloads page](https://cmake.org/download/)

NOTE: Given shell commands are expected to have this directory, `CKernel`, as the working directory.

#### Build System <a name="build-system"></a>

Once the toolchain is installed, invoke CMake to generate a build system:
```shell
cmake -S . -B out
```

When the build system is invoked, it generates the
  output executable file from the local source code.

To invoke the generated build system, and create the kernel executable, use the following command:
```shell
cmake --build out
```

If all goes well, `kernel.elf` should be generated within the `CKernel` directory.

#### Boot Media Generation <a name="boot-media"></a>
In order for the RADII bootloader to load and execute this kernel,
  the kernel executable file must be installed in the root directory
  of the UEFI-compatible storage media.

Given the proper dependencies are installed, CMake targets
  are created to aid in the boot media generation process.

- `image_dir` \-\- Generate `boot/` directory with `kernel.elf` installed.

- `image_raw` \-\- Generate `test-build.img` with `kernel.elf` installed.
  - `dd` \-\- Native command on Unix
  - GNU mtools \-\- MS/DOS filesystem manipulation
    - [Home Page](https://www.gnu.org/software/mtools/)
    - Debian distros: `sudo apt install mtools`

---

### Running <a name="running"></a>

Running this kernel is the same as running RADII (since RADII ultimately loads and runs this kernel). \
For detailed instructions on a multitude of virtual machines, see the [RADII README](./../README.md#vms).

This CMake project inherits the targets from RADII,
  meaning if the proper dependencies are found on the
  system, the CMake targets that launch QEMU will be generated.

NOTE: On Windows using WSL, it is likely a graphical QEMU isn't installed on the WSL, but is installed on the Windows host machine natively. To solve this, I personally build this kernel project with WSL, then launch it using the RADII build tree with `_nodeps` added to the end of the run target (to use the boot media generated by this project instead of RADII bootloader generating new boot media with no kernel installed).

---
